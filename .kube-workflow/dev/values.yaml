app-backend:
  needs: [db]
  volumes:
    - name: uploads
      emptyDir: {}
  volumeMounts:
    - mountPath: /app/public/uploads
      name: uploads
  envFrom:
    - secretRef:
        name: "{{ $.Values.global.pgSecretName }}"
    - secretRef:
        name: backend-sealed-secret
    - configMapRef:
        name: backend-configmap

app-frontend-metropole:
  env:
    - name: NEXT_STRAPI_URL
      value: https://backend-{{ $.Values.global.host }}.dev.fabrique.social.gouv.fr

jobs:
  runs:
    - name: db
      use: SocialGouv/kube-workflow/jobs/create-db@v1
      with:
        pgAdminSecretRefName: azure-pg-admin-user
